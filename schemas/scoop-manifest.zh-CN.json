{
  "$comment": "请使用 vscode，否则 markdownDescription 可能无效",
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://schema.abgox.com/scoop-manifest.zh-CN.json",
  "title": "Scoop 软件包清单(manifest) 的 JSON Schema",
  "type": "object",
  "required": ["version", "description", "homepage", "license"],
  "definitions": {
    "bool": {
      "type": "boolean",
      "examples": [true]
    },
    "str": {
      "type": "string",
      "minLength": 1,
      "allOf": [
        {
          "not": {
            "pattern": "^\\s[^\\s]"
          },
          "errorMessage": "请删除开头的空格"
        },
        {
          "not": {
            "pattern": "[^\\s]\\s$"
          },
          "errorMessage": "请删除末尾的空格"
        }
      ]
    },
    "str_or_arr": {
      "type": ["string", "array"],
      "items": {
        "type": "string",
        "minLength": 1
      },
      "minLength": 1,
      "minItems": 1
    },
    "license_identifier": {
      "$comment": "在此处添加已知的许可证，以便验证器可以提供更好的错误信息",
      "anyOf": [
        {
          "enum": ["MIT"],
          "markdownEnumDescriptions": [
            "[MIT License](https://spdx.org/licenses/MIT.html)"
          ]
        },
        {
          "enum": ["Apache-2.0"],
          "markdownEnumDescriptions": [
            "[Apache License 2.0](https://spdx.org/licenses/Apache-2.0.html)"
          ]
        },
        {
          "enum": ["BSD-3-Clause"],
          "markdownEnumDescriptions": [
            "[BSD 3-Clause \"New\" or \"Revised\" License](https://spdx.org/licenses/BSD-3-Clause.html)"
          ]
        },
        {
          "enum": ["BSD-2-Clause"],
          "markdownEnumDescriptions": [
            "[BSD 2-Clause \"Simplified\" License](https://spdx.org/licenses/BSD-2-Clause.html)"
          ]
        },
        {
          "enum": ["ISC"],
          "markdownEnumDescriptions": [
            "[ISC License](https://spdx.org/licenses/ISC.html)"
          ]
        },
        {
          "enum": ["Unlicense"],
          "markdownEnumDescriptions": [
            "[The Unlicense](https://spdx.org/licenses/Unlicense.html)"
          ]
        },
        {
          "enum": ["CC0-1.0"],
          "markdownEnumDescriptions": [
            "[Creative Commons Zero v1.0 Universal](https://spdx.org/licenses/CC0-1.0.html)"
          ]
        },
        {
          "enum": ["GPL-2.0-only"],
          "markdownEnumDescriptions": [
            "[GNU General Public License v2.0 only](https://spdx.org/licenses/GPL-2.0-only.html)"
          ]
        },
        {
          "enum": ["GPL-2.0-or-later"],
          "markdownEnumDescriptions": [
            "[GNU General Public License v2.0 or later](https://spdx.org/licenses/GPL-2.0-or-later.html)"
          ]
        },
        {
          "enum": ["GPL-3.0-only"],
          "markdownEnumDescriptions": [
            "[GNU General Public License v3.0 only](https://spdx.org/licenses/GPL-3.0-only.html)"
          ]
        },
        {
          "enum": ["GPL-3.0-or-later"],
          "markdownEnumDescriptions": [
            "[GNU General Public License v3.0 or later](https://spdx.org/licenses/GPL-3.0-or-later.html)"
          ]
        },
        {
          "enum": ["AGPL-3.0-only"],
          "markdownEnumDescriptions": [
            "[GNU Affero General Public License v3.0 only](https://spdx.org/licenses/AGPL-3.0-only.html)"
          ]
        },
        {
          "enum": ["AGPL-3.0-or-later"],
          "markdownEnumDescriptions": [
            "[GNU Affero General Public License v3.0 or later](https://spdx.org/licenses/AGPL-3.0-or-later.html)"
          ]
        },
        {
          "enum": ["LGPL-2.1-only"],
          "markdownEnumDescriptions": [
            "[GNU Library General Public License v2.1 only](https://spdx.org/licenses/LGPL-2.1-only.html)"
          ]
        },
        {
          "enum": ["LGPL-2.1-or-later"],
          "markdownEnumDescriptions": [
            "[GNU Library General Public License v2.1 or later](https://spdx.org/licenses/LGPL-2.1-or-later.html)"
          ]
        },
        {
          "enum": ["LGPL-3.0-only"],
          "markdownEnumDescriptions": [
            "[GNU Lesser General Public License v3.0 only](https://spdx.org/licenses/LGPL-3.0-only.html)"
          ]
        },
        {
          "enum": ["LGPL-3.0-or-later"],
          "markdownEnumDescriptions": [
            "[GNU Lesser General Public License v3.0 or later](https://spdx.org/licenses/LGPL-3.0-or-later.html)"
          ]
        },
        {
          "enum": ["MPL-2.0"],
          "markdownEnumDescriptions": [
            "[Mozilla Public License 2.0](https://spdx.org/licenses/MPL-2.0.html)"
          ]
        },
        {
          "enum": ["EPL-1.0"],
          "markdownEnumDescriptions": [
            "[Eclipse Public License 1.0](https://spdx.org/licenses/EPL-1.0.html)"
          ]
        },
        {
          "enum": ["EPL-2.0"],
          "markdownEnumDescriptions": [
            "[Eclipse Public License 2.0](https://spdx.org/licenses/EPL-2.0.html)"
          ]
        },
        {
          "enum": ["CDDL-1.0"],
          "markdownEnumDescriptions": [
            "[Common Development and Distribution License 1.0](https://spdx.org/licenses/CDDL-1.0.html)"
          ]
        },
        {
          "enum": ["BSL-1.0"],
          "markdownEnumDescriptions": [
            "[Boost Software License 1.0](https://spdx.org/licenses/BSL-1.0.html)"
          ]
        },
        {
          "enum": ["MS-PL"],
          "markdownEnumDescriptions": [
            "[Microsoft Public License](https://spdx.org/licenses/MS-PL.html)"
          ]
        },
        {
          "enum": ["MS-RL"],
          "markdownEnumDescriptions": [
            "[Microsoft Reciprocal License](https://spdx.org/licenses/MS-RL.html)"
          ]
        },
        {
          "enum": ["EUPL-1.2"],
          "markdownEnumDescriptions": [
            "[European Union Public License 1.2](https://spdx.org/licenses/EUPL-1.2.html)"
          ]
        },
        {
          "enum": ["CC-BY-4.0"],
          "markdownEnumDescriptions": [
            "[Creative Commons Attribution 4.0 International](https://spdx.org/licenses/CC-BY-4.0.html)"
          ]
        },
        {
          "enum": ["CC-BY-SA-4.0"],
          "markdownEnumDescriptions": [
            "[Creative Commons Attribution Share Alike 4.0 International](https://spdx.org/licenses/CC-BY-SA-4.0.html)"
          ]
        },
        {
          "enum": ["CC-BY-NC-4.0"],
          "markdownEnumDescriptions": [
            "[Creative Commons Attribution Non Commercial 4.0 International](https://spdx.org/licenses/CC-BY-NC-4.0.html)"
          ]
        },
        {
          "enum": ["OFL-1.1"],
          "markdownEnumDescriptions": [
            "[SIL Open Font License 1.1](https://spdx.org/licenses/OFL-1.1.html)"
          ]
        },
        {
          "enum": ["OFL-1.1-no-RFN"],
          "markdownEnumDescriptions": [
            "[SIL Open Font License 1.1 with no Reserved Font Name](https://spdx.org/licenses/OFL-1.1-no-RFN.html)"
          ]
        },
        {
          "enum": ["Artistic-2.0"],
          "markdownEnumDescriptions": [
            "[Artistic License 2.0](https://spdx.org/licenses/Artistic-2.0.html)"
          ]
        },
        {
          "enum": ["Zlib"],
          "markdownEnumDescriptions": [
            "[zlib License](https://spdx.org/licenses/Zlib.html)"
          ]
        },
        {
          "enum": ["Python-2.0"],
          "markdownEnumDescriptions": [
            "[Python License 2.0](https://spdx.org/licenses/Python-2.0.html)"
          ]
        },
        {
          "enum": ["NCSA"],
          "markdownEnumDescriptions": [
            "[University of Illinois/NCSA Open Source License](https://spdx.org/licenses/NCSA.html)"
          ]
        },
        {
          "enum": ["ICU"],
          "markdownEnumDescriptions": [
            "[ICU License](https://spdx.org/licenses/ICU.html)"
          ]
        },
        {
          "enum": ["IPA"],
          "markdownEnumDescriptions": [
            "[IPA Font License](https://spdx.org/licenses/IPA.html)"
          ]
        },
        {
          "enum": ["WTFPL"],
          "markdownEnumDescriptions": [
            "[Do What The F*ck You Want To Public License](https://spdx.org/licenses/WTFPL.html)"
          ]
        },
        {
          "enum": ["OSL-3.0"],
          "markdownEnumDescriptions": [
            "[Open Software License 3.0](https://spdx.org/licenses/OSL-3.0.html)"
          ]
        }
      ]
    },
    "license_field": {
      "anyOf": [
        {
          "enum": ["Unknown"],
          "markdownEnumDescriptions": [
            "[Scoop 官方定义的字段](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifests#required-properties)，表示无法确定许可证(unable to determine the license)"
          ]
        },
        {
          "enum": ["Freeware"],
          "markdownEnumDescriptions": [
            "[Scoop 官方定义的字段](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifests#required-properties)，表示这是一个免费软件(free to use forever)"
          ]
        },
        {
          "enum": ["Proprietary"],
          "markdownEnumDescriptions": [
            "[Scoop 官方定义的字段](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifests#required-properties)，表示这是一个付费软件(must pay to use)"
          ]
        },
        {
          "enum": ["Public Domain"],
          "markdownEnumDescriptions": [
            "[Scoop 官方定义的字段](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifests#required-properties)，表示这是一个属于公有领域的软件(Public Domain)"
          ]
        },
        {
          "enum": ["Shareware"],
          "markdownEnumDescriptions": [
            "[Scoop 官方定义的字段](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifests#required-properties)，表示这是一个免费试用软件，试用结束后必须付费才能继续使用(free to try, must pay eventually)"
          ]
        }
      ]
    },
    "license": {
      "title": "软件许可证",
      "markdownDescription": "- 指定软件的许可证或类型字段\n- 如果不同的文件具有不同的许可证，请使用逗号 `,` 分隔许可证。如果整个应用程序是双重许可的 ，则使用 `|`\n- https://opensource.org/license\n- https://spdx.org/licenses",
      "type": ["string", "object"],
      "examples": [{}],
      "anyOf": [
        {
          "minLength": 1
        },
        {
          "$ref": "#/definitions/license_field"
        },
        {
          "$ref": "#/definitions/license_identifier"
        }
      ],
      "if": {
        "type": "object"
      },
      "then": {
        "required": ["identifier"],
        "additionalProperties": false,
        "properties": {
          "identifier": {
            "title": "许可证标识符",
            "markdownDescription": "- 指定软件的许可证或类型字段\n- 如果不同的文件具有不同的许可证，请使用逗号 `,` 分隔许可证。如果整个应用程序是双重许可的 ，则使用 `|`\n- https://opensource.org/license\n- https://spdx.org/licenses",
            "$ref": "#/definitions/str",
            "anyOf": [
              {
                "minLength": 1
              },
              {
                "$ref": "#/definitions/license_field"
              },
              {
                "$ref": "#/definitions/license_identifier"
              }
            ]
          },
          "url": {
            "examples": [""],
            "allOf": [
              {
                "$ref": "#/definitions/str"
              },
              {
                "$ref": "#/definitions/url_validation"
              }
            ],
            "title": "许可证 URL",
            "markdownDescription": "- 软件许可证的 URL 地址。"
          }
        }
      }
    },
    "notes": {
      "title": "提示信息",
      "markdownDescription": "- 安装软件之后的提示信息",
      "$ref": "#/definitions/str_or_arr"
    },
    "url_validation": {
      "pattern": "^https?://",
      "errorMessage": "需要一个有效的 http/https URL"
    },
    "url": {
      "title": "软件下载地址",
      "markdownDescription": "- 要下载的文件的 URL\n- 如果有多个 URL，可以使用数组\n```json\n  \"url\": [\n      \"http://example.com/file1.zip\",\n      \"http://example.com/file2.zip\"\n  ]\n  ```\n- 如果需要更改下载 URL 的文件名，可以在 URL 结尾加上 `#/dl.7z`，例如:\n```json\n  \"url\": \"http://example.org/program.exe#/dl.7z\"\n  ```\n- Scoop 将下载 program.exe ，但将其保存为 dl.7z ，然后将使用 7-Zip 自动提取",
      "examples": [
        "https://github.com/abgox/abyss/releases/download/empty/empty"
      ],
      "type": ["string", "array"],
      "$ref": "#/definitions/url_validation",
      "minLength": 1,
      "minItems": 1,
      "items": {
        "allOf": [
          {
            "$ref": "#/definitions/str"
          },
          {
            "$ref": "#/definitions/url_validation"
          }
        ],
        "examples": [
          "https://github.com/abgox/abyss/releases/download/empty/empty"
        ]
      }
    },
    "hash": {
      "title": "软件安装包的 hash 值",
      "markdownDescription": "- hash 值默认是 `SHA256`\n- 也可以通过在字符串前加上 `sha512:` `sha1:` 或 `md5:` 来使用 `SHA512`、`SHA1` 或 `MD5`",
      "examples": [
        "36a9e7f1c95b82ffb99743e0c5c4ce95d83c9a430aac59f84ef3cbfab6145068"
      ],
      "type": ["string", "array"],
      "minLength": 1,
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/str",
        "examples": [
          "36a9e7f1c95b82ffb99743e0c5c4ce95d83c9a430aac59f84ef3cbfab6145068"
        ],
        "pattern": "^([a-fA-F0-9]{64}|(sha1|sha256|sha512|md5):([a-fA-F0-9]{32}|[a-fA-F0-9]{40}|[a-fA-F0-9]{64}|[a-fA-F0-9]{128}))$",
        "errorMessage": "不是一个正确的 hash"
      },
      "pattern": "^([a-fA-F0-9]{64}|(sha1|sha256|sha512|md5):([a-fA-F0-9]{32}|[a-fA-F0-9]{40}|[a-fA-F0-9]{64}|[a-fA-F0-9]{128}))$",
      "errorMessage": "不是一个正确的 hash"
    },
    "architecture_example": {
      "examples": [
        {
          "64bit": {
            "url": "https://github.com/abgox/abyss/releases/download/empty/empty",
            "hash": "36a9e7f1c95b82ffb99743e0c5c4ce95d83c9a430aac59f84ef3cbfab6145068"
          },
          "arm64": {
            "url": "https://github.com/abgox/abyss/releases/download/empty/empty",
            "hash": "36a9e7f1c95b82ffb99743e0c5c4ce95d83c9a430aac59f84ef3cbfab6145068"
          }
        }
      ]
    },
    "architecture_property": {
      "examples": [{}],
      "properties": {
        "url": {
          "examples": ["", []],
          "$ref": "#/definitions/url"
        },
        "hash": {
          "$ref": "#/definitions/hash"
        },
        "bin": {
          "$ref": "#/definitions/bin"
        },
        "checkver": {
          "$ref": "#/definitions/checkver"
        },
        "env_add_path": {
          "$comment": "此属性官方文档中未说明，但实际可用",
          "$ref": "#/definitions/env_add_path"
        },
        "extract_dir": {
          "$ref": "#/definitions/extract_dir"
        },
        "installer": {
          "$ref": "#/definitions/installer"
        },
        "pre_install": {
          "$ref": "#/definitions/pre_install"
        },
        "post_install": {
          "$ref": "#/definitions/post_install"
        },
        "shortcuts": {
          "$ref": "#/definitions/shortcuts"
        },
        "uninstaller": {
          "$ref": "#/definitions/uninstaller"
        }
      },
      "minProperties": 1,
      "additionalProperties": false
    },
    "architecture": {
      "title": "架构信息",
      "markdownDescription": "- 程序的架构信息\n- 架构可以用来包装差异",
      "type": "object",
      "minProperties": 1,
      "additionalProperties": false,
      "properties": {
        "64bit": {
          "markdownDescription": "- 64位架构",
          "$ref": "#/definitions/architecture_property"
        },
        "32bit": {
          "markdownDescription": "- 32位架构",
          "$ref": "#/definitions/architecture_property"
        },
        "arm64": {
          "markdownDescription": "- arm64架构",
          "$ref": "#/definitions/architecture_property"
        }
      }
    },
    "extract_dir": {
      "title": "仅提取指定目录",
      "markdownDescription": "- 如果 url 属性的值指向一个压缩包，Scoop 默认会提取所有内容\n    - 压缩包类型: `.zip`/`.7z`/`.tar`/`.gz`/`.lzma`/`.lzh`\n- 如果存在 `extract_dir` 属性，Scoop 将只提取 `extract_dir` 定义的指定目录",
      "$ref": "#/definitions/str_or_arr"
    },
    "extract_to": {
      "title": "提取内容到指定目录",
      "markdownDescription": "- 如果 url 属性的值指向一个压缩包，Scoop 会将所有内容提取到 `extract_to` 定义的指定目录中\n  - 压缩包类型: `.zip`/`.7z`/`.tar`/`.gz`/`.lzma`/`.lzh`\n- 如果 url 是一个数组，有多个压缩包，则 `extract_to` 也应该是一个数组，并且与 url 数组的顺序一致",
      "$ref": "#/definitions/str_or_arr"
    },
    "env_add_path": {
      "title": "添加到环境变量 PATH 中的路径",
      "markdownDescription": "- 将指定目录添加到环境变量(当前用户) PATH 中\n- 如果要指定 `$dir` 目录，请用 `.` 代替\n- 如果安装时使用了 `--global` 或 `-g` 参数，则会添加到环境变量(系统级) PATH 中",
      "type": ["string", "array"],
      "examples": ["", []],
      "minLength": 1,
      "minItems": 1,
      "uniqueItems": true
    },
    "env_set": {
      "title": "设置环境变量",
      "markdownDescription": "- 为用户设置一个或多个环境变量(当前用户)\n- 如果安装时使用了 `--global` 或 `-g` 参数，则会设置到环境变量(系统级) 中\n- 一些可用的变量:\n  - `$dir`\n  - `$persist_dir`\n  - `$home`\n  - `$env:AppData`\n  - ...",
      "type": "object",
      "examples": [{}],
      "if": {
        "type": "object"
      },
      "then": {
        "patternProperties": {
          "^.+$": {
            "$ref": "#/definitions/str",
            "examples": ["$dir\\xxx", "$persist_dir\\xxx"]
          }
        },
        "minProperties": 1,
        "additionalProperties": false,
        "errorMessage": "不允许属性名为空字符串"
      }
    },
    "psmodule": {
      "title": "PowerShell 模块",
      "markdownDescription": "- 作为 PowerShell 模块安装在 `$scoopdir/modules` 中",
      "type": "object",
      "required": ["name"],
      "examples": [
        {
          "name": ""
        }
      ],
      "properties": {
        "name": {
          "title": "模块名称",
          "markdownDescription": "- 模块的名称，它应该与提取目录中的至少一个文件匹配，以便 PowerShell 将其识别为模块",
          "$ref": "#/definitions/str"
        }
      },
      "additionalProperties": false
    },
    "bin": {
      "type": ["string", "array"],
      "items": {
        "type": ["string", "array"],
        "minLength": 1,
        "anyOf": [
          {
            "type": "array",
            "items": {
              "$ref": "#/definitions/str"
            },
            "allOf": [
              {
                "items": [
                  {
                    "markdownDescription": "程序名"
                  },
                  {
                    "markdownDescription": "别名 (shim)"
                  },
                  {
                    "markdownDescription": "参数，它是可选的"
                  }
                ]
              },
              {
                "if": {
                  "minItems": 1,
                  "maxItems": 1
                },
                "then": {
                  "not": true,
                  "errorMessage": "缺少第二个必需值: 别名 (shim)"
                }
              },
              {
                "if": {
                  "maxItems": 0
                },
                "then": {
                  "not": true,
                  "errorMessage": "缺少两个必需值: 程序名、别名 (shim)"
                }
              }
            ],
            "minItems": 1,
            "maxItems": 3
          },
          {
            "$ref": "#/definitions/str"
          }
        ]
      },
      "minLength": 1,
      "minItems": 1,
      "uniqueItems": true,
      "title": "一个程序(可执行文件或脚本)的字符串或字符串数组",
      "markdownDescription": "- 一个程序(可执行文件或脚本)的字符串或字符串数组，可在用户路径上使用\n- 可以通过一个二维数组来创建一个别名 shim，它使用与真实的可执行文件不同的名称，并(可选地)将参数传递给可执行文件\n- 二维数组应该包含最多三个字符串：程序名,别名,参数(可选)\n- 示例 1: Scoop 会创建一个名为 `a` 的 shim，后续可以直接使用 `a` 命令去运行 a.exe\n```json\n  \"bin\": \"a.exe\"\n  ```\n- 示例 2: 和示例 1 的效果差不多，只是 Scoop 会创建两个 shim，分别是 `a` 和 `b`\n```json\n  \"bin\": [\"a.exe\", \"b.exe\"]\n  ```\n- 示例 3: 和示例 2 的效果差不多，只是创建的两个 shim 的名称变成了 `ax` 和 `bx`\n```json\n  \"bin\": [\n    [\"a.exe\", \"ax\"], \n    [\"b.exe\", \"bx\"]\n  ]\n  ```\n- 示例 4: 和示例 3 的效果差不多，只是当运行它们时，会携带上 `--config $dir/config.json` 参数\n```json\n  \"bin\": [\n    [\"a.exe\", \"ax\", \"--config $dir/config.json\"], \n    [\"b.exe\", \"bx\", \"--config $dir/config.json\"]\n  ]\n  ```"
    },
    "shortcuts": {
      "type": "array",
      "title": "添加到开始菜单的快捷方式",
      "markdownDescription": "- 指定添加到开始菜单的快捷方式，它们会被放在 `Scoop Apps` 目录中\n- 每个数组中可以包含四个值\n    1. 必需值: 目标文件的路径\n    2. 必需值: 快捷方式的名称，支持子目录: `aaa\\bbb`\n    3. 可选值: 启动参数\n    4. 可选值: 图标文件的路径",
      "items": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/str"
        },
        "allOf": [
          {
            "items": [
              {
                "markdownDescription": "目标文件的路径"
              },
              {
                "markdownDescription": "快捷方式的名称，支持子目录: `aaa\\bbb`"
              },
              {
                "markdownDescription": "启动参数，它是可选的"
              },
              {
                "markdownDescription": "图标文件的路径，它是可选的"
              }
            ]
          },
          {
            "if": {
              "minItems": 1,
              "maxItems": 1
            },
            "then": {
              "not": true,
              "errorMessage": "缺少第二个必需值: 快捷方式名称"
            }
          },
          {
            "if": {
              "maxItems": 0
            },
            "then": {
              "not": true,
              "errorMessage": "缺少两个必需值: 目标文件路径、快捷方式名称"
            }
          }
        ],
        "minItems": 1,
        "maxItems": 4
      },
      "minItems": 1,
      "uniqueItems": true
    },
    "persist": {
      "title": "持久化数据",
      "markdownDescription": "- Scoop 将对指定的目录和文件进行数据持久化\n- 需要注意: Scoop 默认会进行目录链接，如果你希望进行文件链接，你需要先在安装脚本中创建此文件\n- 示例 1: Scoop 会进行目录链接: `$dir\\data` => `$persist_dir\\data`\n```json\n  \"persist\": \"data\"\n  ```\n- 示例 2: 和示例 1 的效果差不多，只是 Scoop 会进行多次链接\n```json\n  \"persist\": [\"data\", \"config.json\"]\n  ```\n- 示例 3: 和示例 2 的效果差不多，只是额外指定了目标位置\n```json\n  \"persist\": [\n    [\"app\\\\data\", \"userData\"], \n    [\"app\\\\config.json\", \"config.json\"]\n  ]\n  ```",
      "type": ["string", "array"],
      "items": {
        "type": ["string", "array"],
        "minLength": 1,
        "anyOf": [
          {
            "type": "array",
            "items": {
              "$ref": "#/definitions/str"
            },
            "allOf": [
              {
                "items": [
                  {
                    "markdownDescription": "persist 的原始文件或目录"
                  },
                  {
                    "markdownDescription": "persist 的目标位置，支持子目录: `aaa\\bbb`"
                  }
                ]
              },
              {
                "if": {
                  "minItems": 1,
                  "maxItems": 1
                },
                "then": {
                  "not": true,
                  "errorMessage": "缺少第二个必需值: persist 的目标位置"
                }
              },
              {
                "if": {
                  "maxItems": 0
                },
                "then": {
                  "not": true,
                  "errorMessage": "缺少两个必需值: 需要 persist 的原始文件或目录、persist 的目标位置"
                }
              }
            ],
            "minItems": 1,
            "maxItems": 3
          },
          {
            "$ref": "#/definitions/str"
          }
        ]
      },
      "minLength": 1,
      "minItems": 1,
      "uniqueItems": true,
      "examples": ["", [], [[]]]
    },
    "pre_install": {
      "title": "预安装脚本",
      "markdownDescription": "- 用于在安装应用程序之前执行命令\n- 执行顺序: `pre_install` -> `installer` -> `post_install`\n\n|可用的变量|说明|\n|:-:|-|\n|`$app`|应用程序名称(应用清单名称)|\n|`$architecture`|CPU 架构, 如: `64bit` `32bit` `arm64`|\n|`$cmd`|当前正在运行的子命令, 如: `uninstall` `update` `install`|\n|`$fname`|下载的文件名(可能是多个文件，需要当做数组处理，除非你确定 url 不是数组)|\n|`$scoopConfig`|Scoop 配置(PowerShell 对象)，如 {SCOOP_BRANCH, SCOOP_REPO}|\n|`$global`|如果安装时使用了 `-g` 或 `--global`，则为 `$true`|\n|`$manifest`|反序列化清单(PowerShell 对象)，如 @{version=1.2.3; description=xxx;...}|\n|`$version`|正在安装的版本，如 1.2.3|\n|`$dir`|应用程序安装目录(实际版本号目录)|\n|`$persist_dir`|数据持久化目录|\n|`$bucketsdir`|Scoop buckets 目录，如 D:\\scoop\\buckets|\n|`$bucket`|当前安装应用所属于的 bucket 名称|\n|`$cachedir`|Scoop cache 目录|\n|`$configFile`|Scoop 配置的路径|\n|`$globaldir`|全局安装目录|\n|`$original_dir`|应用程序安装目录(实际版本号目录)|\n|`$scoopdir`|Scoop 所在目录|",
      "$ref": "#/definitions/str_or_arr"
    },
    "installer": {
      "title": "安装程序配置",
      "markdownDescription": "- 运行非 MSI 安装程序的配置\n- 在 scoop install 和 scoop update 期间调用\n- 执行顺序: `pre_install` -> `installer` -> `post_install`",
      "type": "object",
      "minProperties": 1,
      "additionalProperties": false,
      "examples": [{}],
      "properties": {
        "file": {
          "markdownDescription": "安装程序可执行文件\n- 对于 installer，默认为最后下载的 URL\n- 如果指定了它， uninstaller 中也需要指定",
          "$ref": "#/definitions/str"
        },
        "script": {
          "markdownDescription": "作为安装程序而不是 file 执行\n- 脚本中可用的变量: \n    - $fname: 下载的文件(可能是多个文件，需要当做数组处理，除非你确定 url 不是数组)\n    - $manifest: 已验证的清单引用\n    - $architecture: 64bit/32bit/arm64\n    - $dir: 安装目录",
          "$ref": "#/definitions/str_or_arr"
        },
        "args": {
          "type": "array",
          "markdownDescription": "传递给安装程序的参数数组\n- 它是一个可选的属性",
          "items": {
            "$ref": "#/definitions/str"
          },
          "minItems": 1
        },
        "keep": {
          "markdownDescription": "如果安装程序在运行后应该保留(例如，用于将来的卸载)，则设置为 true\n- 如果忽略或设置为任何其他值，安装程序将在运行后被删除",
          "$ref": "#/definitions/bool"
        }
      }
    },
    "post_install": {
      "title": "后安装脚本",
      "markdownDescription": "- 用于在安装应用程序之后执行命令\n- 执行顺序: `pre_install` -> `installer` -> `post_install`\n- 需要注意，此时 Scoop 已经完成 persist，因此如果需要创建文件用于 persist, 需要在 `pre_install` 中提前定义\n\n|可用的变量|说明|\n|:-:|-|\n|`$app`|应用程序名称(应用清单名称)|\n|`$architecture`|CPU 架构, 如: `64bit` `32bit` `arm64`|\n|`$cmd`|当前正在运行的子命令, 如: `uninstall` `update` `install`|\n|`$fname`|下载的文件名(可能是多个文件，需要当做数组处理，除非你确定 url 不是数组)|\n|`$scoopConfig`|Scoop 配置(PowerShell 对象)，如 {SCOOP_BRANCH, SCOOP_REPO}|\n|`$global`|如果安装时使用了 `-g` 或 `--global`，则为 `$true`|\n|`$manifest`|反序列化清单(PowerShell 对象)，如 @{version=1.2.3; description=xxx;...}|\n|`$version`|正在安装的版本，如 1.2.3|\n|`$dir`|应用程序安装目录(current 目录)|\n|`$persist_dir`|数据持久化目录|\n|`$bucketsdir`|Scoop buckets 目录，如 D:\\scoop\\buckets|\n|`$bucket`|当前安装应用所属于的 bucket 名称|\n|`$cachedir`|Scoop cache 目录|\n|`$configFile`|Scoop 配置的路径|\n|`$globaldir`|全局安装目录|\n|`$original_dir`|应用程序安装目录(实际版本号目录)|\n|`$scoopdir`|Scoop 所在目录|",
      "$ref": "#/definitions/str_or_arr"
    },
    "pre_uninstall": {
      "title": "预卸载脚本",
      "markdownDescription": "- 用于在卸载应用程序之前执行命令\n- 执行顺序: `pre_uninstall` -> `uninstaller` -> `post_uninstall`\n\n|可用的变量|说明|\n|:-:|-|\n|`$app`|应用程序名称(应用清单名称)|\n|`$architecture`|CPU 架构, 如: `64bit` `32bit` `arm64`|\n|`$cmd`|当前正在运行的子命令, 如: `uninstall` `update` `install`|\n|`$fname`|下载的文件名(可能是多个文件，需要当做数组处理，除非你确定 url 不是数组)|\n|`$scoopConfig`|Scoop 配置(PowerShell 对象)，如 {SCOOP_BRANCH, SCOOP_REPO}|\n|`$global`|如果安装时使用了 `-g` 或 `--global`，则为 `$true`|\n|`$manifest`|反序列化清单(PowerShell 对象)，如 @{version=1.2.3; description=xxx;...}|\n|`$version`|正在安装的版本，如 1.2.3|\n|`$dir`|应用程序安装目录(实际版本号目录)|\n|`$persist_dir`|数据持久化目录|\n|`$bucketsdir`|Scoop buckets 目录，如 D:\\scoop\\buckets|\n|`$bucket`|当前安装应用所属于的 bucket 名称|\n|`$cachedir`|Scoop cache 目录|\n|`$configFile`|Scoop 配置的路径|\n|`$globaldir`|全局安装目录|\n|`$original_dir`|应用程序安装目录(实际版本号目录)|\n|`$scoopdir`|Scoop 所在目录|",
      "$ref": "#/definitions/str_or_arr"
    },
    "uninstaller": {
      "title": "卸载程序配置",
      "markdownDescription": "- 运行非 MSI 卸载程序的配置\n- 在 scoop uninstall 和 scoop update 期间调用\n- 执行顺序: `pre_uninstall` -> `uninstaller` -> `post_uninstall`",
      "type": "object",
      "minProperties": 1,
      "additionalProperties": false,
      "examples": [{}],
      "properties": {
        "file": {
          "markdownDescription": "卸载程序可执行文件",
          "$ref": "#/definitions/str"
        },
        "script": {
          "markdownDescription": "作为卸载程序而不是 file 执行\n- 脚本中可用的变量: \n    - $fname: 下载的文件(可能是多个文件，需要当做数组处理，除非你确定 url 不是数组)\n    - $manifest: 已验证的清单引用\n    - $architecture: 64bit/32bit/arm64\n    - $dir: 安装目录",
          "$ref": "#/definitions/str_or_arr"
        },
        "args": {
          "type": "array",
          "markdownDescription": "传递给卸载程序的参数数组\n- 它是一个可选的属性",
          "items": {
            "$ref": "#/definitions/str"
          },
          "minItems": 1
        }
      }
    },
    "post_uninstall": {
      "title": "后卸载脚本",
      "markdownDescription": "- 用于在卸载应用程序之后执行命令\n- 执行顺序: `pre_uninstall` -> `uninstaller` -> `post_uninstall`\n\n|可用的变量|说明|\n|:-:|-|\n|`$app`|应用程序名称(应用清单名称)|\n|`$architecture`|CPU 架构, 如: `64bit` `32bit` `arm64`|\n|`$cmd`|当前正在运行的子命令, 如: `uninstall` `update` `install`|\n|`$fname`|下载的文件名(可能是多个文件，需要当做数组处理，除非你确定 url 不是数组)|\n|`$scoopConfig`|Scoop 配置(PowerShell 对象)，如 {SCOOP_BRANCH, SCOOP_REPO}|\n|`$global`|如果安装时使用了 `-g` 或 `--global`，则为 `$true`|\n|`$manifest`|反序列化清单(PowerShell 对象)，如 @{version=1.2.3; description=xxx;...}|\n|`$version`|正在安装的版本，如 1.2.3|\n|`$dir`|应用程序安装目录(current 目录)|\n|`$persist_dir`|数据持久化目录|\n|`$bucketsdir`|Scoop buckets 目录，如 D:\\scoop\\buckets|\n|`$bucket`|当前安装应用所属于的 bucket 名称|\n|`$cachedir`|Scoop cache 目录|\n|`$configFile`|Scoop 配置的路径|\n|`$globaldir`|全局安装目录|\n|`$original_dir`|应用程序安装目录(实际版本号目录)|\n|`$scoopdir`|Scoop 所在目录|",
      "$ref": "#/definitions/str_or_arr"
    },
    "checkver": {
      "title": "版本检查配置",
      "markdownDescription": "- 应用维护者和开发者可以使用 bin/checkver 工具来检查应用的更新版本\n- 字符串：在主页上查找版本的 RegEx\n- 对象：更丰富的配置",
      "type": ["string", "object"],
      "examples": ["", "github", {}],
      "minLength": 1,
      "oneOf": [
        {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "url": {
              "markdownDescription": "版本所在页面",
              "$ref": "#/definitions/str"
            },
            "github": {
              "markdownDescription": "应用的 github 仓库地址",
              "$ref": "#/definitions/str",
              "if": {
                "type": "string"
              },
              "then": {
                "minLength": 1,
                "pattern": "^https?://github\\.com/[^/]+/[^/]+/?$",
                "not": {
                  "pattern": "\\.git(\\/|$)"
                },
                "errorMessage": "github 仓库地址格式错误，请使用正确格式，如: https://github.com/abgox/abyss"
              }
            },
            "re": {
              "markdownDescription": "re 是 regex 的别名\n查找版本的 RegEx (正则表达式)",
              "$ref": "#/definitions/str"
            },
            "regex": {
              "markdownDescription": "查找版本的 RegEx (正则表达式)",
              "$ref": "#/definitions/str",
              "examples": ["(.+)"]
            },
            "jsonpath": {
              "markdownDescription": "使用带有 JSONPath 表达式的 JSON 端点检索版本，可以使用点标注或括号标注。\n- 使用示例:\n    - `\"$.version\"`: 提取 `version` 字段的值\n    - `\"$..[?(@.productVersion || @.version)]\"`: 提取 `productVersion` 或 `version` 字段的值\n    - `\"$.assets[?(@.name == 'xxx')].updated_at\"`: 提取 `assets` 中 `name` 为 `xxx` 的字段中的 `updated_at`\n    - `\"$..['productVersion','version']\"`:\n      - 提取这两个字段的值，并形成一个数组\n      - 如 `\"[\"1.2.3\",\"1.2.3-rc\"]\"`",
              "$ref": "#/definitions/str"
            },
            "jp": {
              "markdownDescription": "jp 是 jsonpath 的别名\n使用带有 JSONPath 表达式的 JSON 端点检索版本，可以使用点标注或括号标注。\n- 使用示例:\n    - `\"$.version\"`: 提取 `version` 字段的值\n    - `\"$..[?(@.productVersion || @.version)]\"`: 提取 `productVersion` 或 `version` 字段的值\n    - `\"$.assets[?(@.name == 'xxx')].updated_at\"`: 提取 `assets` 中 `name` 为 `xxx` 的字段中的 `updated_at`\n    - `\"$..['productVersion','version']\"`:\n      - 提取这两个字段的值，并形成一个数组\n      - 如 `\"[\"1.2.3\",\"1.2.3-rc\"]\"`",
              "$ref": "#/definitions/str"
            },
            "xpath": {
              "markdownDescription": "查找版本的 XPath 表达式",
              "$ref": "#/definitions/str"
            },
            "reverse": {
              "markdownDescription": "如果设置为 true, 则匹配最后一次出现(默认为匹配第一次出现)",
              "$ref": "#/definitions/bool"
            },
            "replace": {
              "markdownDescription": "用计算值替换匹配值",
              "$ref": "#/definitions/str",
              "anyOf": [
                {},
                {
                  "enum": ["${1}.${2}.${3}.${4}${5}${6}"],
                  "markdownEnumDescriptions": [
                    "替换匹配值，其中 `${1}` 表示第一个匹配组，`${2}` 表示第二个匹配组，以此类推。"
                  ]
                }
              ]
            },
            "useragent": {
              "markdownDescription": "用于获取网页内容的 User-Agent",
              "$ref": "#/definitions/str"
            },
            "script": {
              "markdownDescription": "可包含 PowerShell 命令的字符串或字符串数组，用于跟踪多个链接",
              "$ref": "#/definitions/str_or_arr"
            },
            "sourceforge": {
              "markdownDescription": "SourceForge 项目的版本检查配置",
              "$ref": "#/definitions/str"
            }
          },
          "minProperties": 1
        },
        {
          "$ref": "#/definitions/str",
          "anyOf": [
            {},
            {
              "enum": ["github"],
              "markdownEnumDescriptions": [
                "如果 homepage 是 github 仓库主页，就可以直接使用 \"github\" 字符串作为 checkver 配置"
              ]
            }
          ]
        }
      ]
    },
    "autoupdate_url": {
      "title": "软件的下载地址",
      "markdownDescription": "- 它通常是动态的，会包含一些 [版本变量](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifest-Autoupdate#version-variables)，参考 `autoupdate` 字段的悬停提示\n- 例如: `https://github.com/owner/repo/releases/download/v$version/xxx.exe`\n- 如果有多个 URL，可以使用数组\n```json\n  \"url\": [\n      \"http://example.com/file1.zip\",\n      \"http://example.com/file2.zip\"\n  ]\n  ```\n- 如果需要更改下载 URL 的文件名，可以在 URL 结尾加上 `#/dl.7z`，例如:\n```json\n  \"url\": \"http://example.org/program.exe#/dl.7z\"\n  ```\n- Scoop 将下载 program.exe ，但将其保存为 dl.7z ，然后将使用 7-Zip 自动提取",
      "type": ["string", "array"],
      "examples": ["", []],
      "minLength": 1,
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/str"
      }
    },
    "autoupdate_hash": {
      "markdownDescription": "定义 hash 的获取",
      "type": "object",
      "additionalProperties": false,
      "minProperties": 1,
      "properties": {
        "url": {
          "markdownDescription": "用于下载 RDF/JSON 文件或提取 hash 的 URL 模板",
          "$ref": "#/definitions/str"
        },
        "regex": {
          "markdownDescription": "RegEx 表达式来提取 hash (别名：find)",
          "$ref": "#/definitions/str"
        },
        "find": {
          "markdownDescription": "RegEx 表达式来提取 hash (别名：regex)",
          "$ref": "#/definitions/str"
        },
        "mode": {
          "title": "获取 hash 的模式",
          "oneOf": [
            {
              "enum": ["github"],
              "markdownEnumDescriptions": [
                "获取 Github 自动生成的 hash，详情查看 [Github blog](https://github.blog/changelog/2025-06-03-releases-now-expose-digests-for-release-assets/)"
              ]
            },
            {
              "enum": ["extract"],
              "markdownEnumDescriptions": [
                "通过 RegEx 从纯文本文件或网页中提取(默认，可省略)"
              ]
            },
            {
              "enum": ["json"],
              "markdownEnumDescriptions": ["通过 JSONPath 从 JSON 文件中提取"]
            },
            {
              "enum": ["xpath"],
              "markdownEnumDescriptions": ["通过 XML 文件提取"]
            },
            {
              "enum": ["rdf"],
              "markdownEnumDescriptions": ["从 RDF 文件中提取"]
            },
            {
              "enum": ["metalink"],
              "markdownEnumDescriptions": [
                "从 Metalink 的头文件或 .meta4 文件中提取"
              ]
            },
            {
              "enum": ["fosshub"],
              "markdownEnumDescriptions": ["为 FossHub 预定义"]
            },
            {
              "enum": ["sourceforge"],
              "markdownEnumDescriptions": ["为 SourceForge 预定义"]
            },
            {
              "enum": ["download"],
              "markdownEnumDescriptions": [
                "下载应用程序文件并在本地对其进行散列(回退)"
              ]
            }
          ]
        },
        "jp": {
          "markdownDescription": "JSONPath 表达式提取 hash (别名：jsonpath)\n- 使用示例:\n    - `\"$.version\"`: 提取 `version` 字段的值\n    - `\"$..[?(@.productVersion || @.version)]\"`: 提取 `productVersion` 或 `version` 字段的值\n    - `\"$.assets[?(@.name == 'xxx')].updated_at\"`: 提取 `assets` 中 `name` 为 `xxx` 的字段中的 `updated_at`\n    - `\"$..['productVersion','version']\"`:\n      - 提取这两个字段的值，并形成一个数组\n      - 如 `\"[\"1.2.3\",\"1.2.3-rc\"]\"`",
          "$ref": "#/definitions/str"
        },
        "jsonpath": {
          "markdownDescription": "JSONPath 表达式提取 hash (别名：jp)\n- 使用示例:\n    - `\"$.version\"`: 提取 `version` 字段的值\n    - `\"$..[?(@.productVersion || @.version)]\"`: 提取 `productVersion` 或 `version` 字段的值\n    - `\"$.assets[?(@.name == 'xxx')].updated_at\"`: 提取 `assets` 中 `name` 为 `xxx` 的字段中的 `updated_at`\n    - `\"$..['productVersion','version']\"`:\n      - 提取这两个字段的值，并形成一个数组\n      - 如 `\"[\"1.2.3\",\"1.2.3-rc\"]\"`",
          "$ref": "#/definitions/str"
        },
        "xpath": {
          "markdownDescription": "XPath 表达式来提取 hash 值",
          "$ref": "#/definitions/str"
        }
      }
    },
    "autoupdate_architecture": {
      "required": ["url"],
      "properties": {
        "url": {
          "$ref": "#/definitions/autoupdate_url"
        },
        "hash": {
          "$ref": "#/definitions/autoupdate_hash"
        },
        "bin": {
          "$ref": "#/definitions/bin"
        },
        "checkver": {
          "$ref": "#/definitions/checkver"
        },
        "env_add_path": {
          "$comment": "此属性官方规范中未说明，但实际可用",
          "$ref": "#/definitions/env_add_path"
        },
        "extract_dir": {
          "$ref": "#/definitions/extract_dir"
        },
        "installer": {
          "$ref": "#/definitions/installer"
        },
        "pre_install": {
          "$ref": "#/definitions/pre_install"
        },
        "post_install": {
          "$ref": "#/definitions/post_install"
        },
        "shortcuts": {
          "$ref": "#/definitions/shortcuts"
        },
        "uninstaller": {
          "$ref": "#/definitions/uninstaller"
        }
      },
      "minProperties": 1,
      "additionalProperties": false
    },
    "github_release_url": {
      "required": ["url"],
      "properties": {
        "url": {
          "type": ["array", "string"],
          "examples": ["", []],
          "pattern": "^https://github\\.com/[^/]+/[^/]+/releases/download/",
          "items": {
            "type": "string",
            "pattern": "^https://github\\.com/[^/]+/[^/]+/releases/download/"
          }
        }
      }
    },
    "url_hash_type_match": {
      "required": ["url", "hash"],
      "if": {
        "properties": {
          "url": {
            "type": "string"
          }
        }
      },
      "then": {
        "properties": {
          "hash": {
            "$ref": "#/definitions/str",
            "errorMessage": "url 和 hash 的类型不相同"
          }
        }
      },
      "else": {
        "properties": {
          "hash": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/hash"
            },
            "minItems": 1,
            "errorMessage": "url 和 hash 的类型不相同"
          }
        }
      }
    }
  },
  "properties": {
    "##": {
      "title": "注释",
      "markdownDescription": "- 给此清单的读者或维护者的注释。",
      "$ref": "#/definitions/str_or_arr"
    },
    "version": {
      "title": "软件版本",
      "markdownDescription": "- 软件的版本号",
      "$ref": "#/definitions/str",
      "examples": ["0.0.0"],
      "anyOf": [
        {},
        {
          "enum": ["0.0.0"],
          "markdownEnumDescriptions": ["使用 0.0.0 版本"]
        },
        {
          "enum": ["nightly"],
          "markdownEnumDescriptions": ["使用 nightly 版本"]
        }
      ]
    },
    "description": {
      "title": "软件描述",
      "markdownDescription": "- 软件的简短描述",
      "$ref": "#/definitions/str"
    },
    "homepage": {
      "title": "软件主页",
      "markdownDescription": "- 软件的主页或仓库地址",
      "examples": [""],
      "allOf": [
        {
          "$ref": "#/definitions/str"
        },
        {
          "$ref": "#/definitions/url_validation"
        }
      ],
      "if": {
        "pattern": "^https?://[^/]+$"
      },
      "then": {
        "not": true,
        "errorMessage": "如果是官网根域名，请以 '/' 结尾"
      }
    },
    "license": {
      "$ref": "#/definitions/license"
    },
    "depends": {
      "title": "依赖项",
      "markdownDescription": "- 应用程序的必要依赖项\n- 未安装的依赖项将在应用程序安装前自动安装\n- 如果依赖项是可选的，请使用 `suggest` 属性",
      "$ref": "#/definitions/str_or_arr"
    },
    "suggest": {
      "title": "建议的依赖项",
      "markdownDescription": "- 显示一条消息，建议提供补充功能的可选应用程序\n- 如果已经安装了针对该功能建议的任何应用程序，则该功能将被视为 **已实现**，用户不会看到任何建议",
      "type": "object",
      "if": {
        "type": "object"
      },
      "then": {
        "patternProperties": {
          "^.+$": {
            "markdownDescription": "- 当指定的建议已经安装，则不会显示该建议。\n- 如果是一个数组，它表示只要数组中任意一个建议被安装，则不会显示该建议",
            "$ref": "#/definitions/str_or_arr"
          }
        },
        "minProperties": 1,
        "additionalProperties": false,
        "errorMessage": "不允许属性名为空字符串"
      }
    },
    "notes": {
      "$ref": "#/definitions/notes"
    },
    "url": {
      "$ref": "#/definitions/url"
    },
    "hash": {
      "$ref": "#/definitions/hash"
    },
    "architecture": {
      "$ref": "#/definitions/architecture"
    },
    "extract_dir": {
      "$ref": "#/definitions/extract_dir"
    },
    "extract_to": {
      "$ref": "#/definitions/extract_to"
    },
    "env_add_path": {
      "$ref": "#/definitions/env_add_path"
    },
    "env_set": {
      "$ref": "#/definitions/env_set"
    },
    "innosetup": {
      "markdownDescription": "如果安装程序基于 `InnoSetup`，则设置为 `true`",
      "$ref": "#/definitions/bool"
    },
    "psmodule": {
      "$ref": "#/definitions/psmodule"
    },
    "bin": {
      "$ref": "#/definitions/bin"
    },
    "shortcuts": {
      "$ref": "#/definitions/shortcuts"
    },
    "persist": {
      "$ref": "#/definitions/persist"
    },
    "pre_install": {
      "$ref": "#/definitions/pre_install"
    },
    "installer": {
      "$ref": "#/definitions/installer"
    },
    "post_install": {
      "$ref": "#/definitions/post_install"
    },
    "pre_uninstall": {
      "$ref": "#/definitions/pre_uninstall"
    },
    "uninstaller": {
      "$ref": "#/definitions/uninstaller"
    },
    "post_uninstall": {
      "$ref": "#/definitions/post_uninstall"
    },
    "checkver": {
      "$ref": "#/definitions/checkver"
    },
    "autoupdate": {
      "title": "自动更新",
      "markdownDescription": "- 它将通过 [Github Actions](https://github.com/ScoopInstaller/GithubActions) 去自动更新清单\n - Scoop 允许使用 `scoop install AppName@1.2.3` 安装特定版本\n - 但前提是，清单文件中 `autoupdate` 的所有 `url` 只能包含以下 [版本变量](https://github.com/ScoopInstaller/Scoop/wiki/App-Manifest-Autoupdate#version-variables)\n  - `$version`: `3.7.1.2-rc.1`\n    - `$majorVersion`: `3`\n    - `$minorVersion`: `7`\n    - `$patchVersion`: `1`\n    - `$buildVersion`: `2`\n    - `$preReleaseVersion`: `rc.1`\n  - `$dotVersion`: `3.7.1.2.rc.1`\n  - `$dashVersion`: `3-7-1-2-rc-1`\n  - `$underscoreVersion`: `3_7_1_2_rc_1`\n  - `$cleanVersion`: `3712rc1`\n  - `$matchHead`: `3.7.1`\n  - `$matchTail`: `.2-rc.1`",
      "type": "object",
      "minProperties": 1,
      "examples": [
        {
          "url": ""
        },
        {
          "architecture": {
            "64bit": {
              "url": ""
            }
          }
        }
      ],
      "properties": {
        "architecture": {
          "type": "object",
          "title": "自动更新架构",
          "markdownDescription": "- 定义自动更新的架构\n- 架构可以用来包装差异",
          "properties": {
            "64bit": {
              "markdownDescription": "64位架构",
              "$ref": "#/definitions/autoupdate_architecture"
            },
            "32bit": {
              "markdownDescription": "32位架构",
              "$ref": "#/definitions/autoupdate_architecture"
            },
            "arm64": {
              "markdownDescription": "arm64架构",
              "$ref": "#/definitions/autoupdate_architecture"
            }
          },
          "additionalProperties": false,
          "minProperties": 1
        },
        "notes": {
          "$ref": "#/definitions/notes"
        },
        "url": {
          "$ref": "#/definitions/autoupdate_url"
        },
        "hash": {
          "$ref": "#/definitions/autoupdate_hash"
        },
        "bin": {
          "$ref": "#/definitions/bin"
        },
        "extract_dir": {
          "$ref": "#/definitions/extract_dir"
        },
        "extract_to": {
          "$ref": "#/definitions/extract_to"
        },
        "env_add_path": {
          "$ref": "#/definitions/env_add_path"
        },
        "env_set": {
          "$ref": "#/definitions/env_set"
        },
        "installer": {
          "$ref": "#/definitions/installer"
        },
        "license": {
          "$ref": "#/definitions/license"
        },
        "persist": {
          "$ref": "#/definitions/persist"
        },
        "post_install": {
          "$ref": "#/definitions/post_install"
        },
        "psmodule": {
          "$ref": "#/definitions/psmodule"
        },
        "shortcuts": {
          "$ref": "#/definitions/shortcuts"
        }
      }
    }
  },
  "allOf": [
    {
      "required": ["version", "description", "homepage", "license"]
    },
    {
      "$comment": "Scoop 的标准规范",
      "allOf": [
        {
          "$comment": "如果定义了 checkver，就必须定义 autoupdate",
          "allOf": [
            {
              "if": {
                "required": ["checkver"]
              },
              "then": {
                "if": {
                  "required": ["autoupdate"]
                },
                "else": {
                  "properties": {
                    "checkver": {
                      "not": true,
                      "errorMessage": "如果定义了 checkver，就必须定义 autoupdate"
                    }
                  }
                }
              }
            },
            {
              "if": {
                "required": ["autoupdate"]
              },
              "then": {
                "if": {
                  "required": ["checkver"]
                },
                "else": {
                  "properties": {
                    "autoupdate": {
                      "not": true,
                      "errorMessage": "如果定义了 autoupdate，就必须定义 checkver"
                    }
                  }
                }
              }
            }
          ]
        },
        {
          "$comment": "如果 url 是 github releases 链接，则需要指定 hash 模式为 github",
          "properties": {
            "autoupdate": {
              "type": "object",
              "if": {
                "oneOf": [
                  {
                    "$ref": "#/definitions/github_release_url"
                  },
                  {
                    "required": ["architecture"],
                    "properties": {
                      "architecture": {
                        "type": "object",
                        "anyOf": [
                          {
                            "required": ["64bit"]
                          },
                          {
                            "required": ["arm64"]
                          },
                          {
                            "required": ["32bit"]
                          }
                        ],
                        "patternProperties": {
                          "^(64bit|arm64|32bit)$": {
                            "$ref": "#/definitions/github_release_url"
                          }
                        }
                      }
                    }
                  }
                ]
              },
              "then": {
                "required": ["hash"],
                "properties": {
                  "hash": {
                    "required": ["mode"],
                    "properties": {
                      "mode": {
                        "const": "github"
                      }
                    }
                  }
                }
              },
              "else": {
                "properties": {
                  "hash": {
                    "properties": {
                      "mode": {
                        "not": {
                          "const": "github"
                        },
                        "errorMessage": "url 不是标准的 Github Releases"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "$comment": "如果存在 license，但不存在 url 或 architecture 就触发警告",
          "if": {
            "not": {
              "anyOf": [
                {
                  "required": ["url"]
                },
                {
                  "required": ["architecture"]
                }
              ]
            }
          },
          "then": {
            "not": {
              "anyOf": [
                {
                  "not": {
                    "required": ["url"]
                  }
                },
                {
                  "not": {
                    "required": ["architecture"]
                  }
                }
              ]
            },
            "errorMessage": "缺少 url 或 architecture 属性"
          }
        },
        {
          "$comment": "url 和 architecture 只能选其一。url 和 hash 类型必须匹配",
          "if": {
            "required": ["url"]
          },
          "then": {
            "properties": {
              "architecture": {
                "patternProperties": {
                  "^(64bit|arm64|32bit)$": {
                    "properties": {
                      "url": {
                        "not": true,
                        "errorMessage": "url 和顶层的 url 冲突，你只能选择其中一种方式"
                      },
                      "hash": {
                        "not": true,
                        "errorMessage": "如果有顶层的 url，禁止定义 architecture 中的 hash"
                      }
                    }
                  }
                }
              }
            },
            "$ref": "#/definitions/url_hash_type_match"
          },
          "else": {
            "properties": {
              "architecture": {
                "$ref": "#/definitions/architecture_example",
                "patternProperties": {
                  "^(64bit|arm64|32bit)$": {
                    "$ref": "#/definitions/url_hash_type_match"
                  }
                }
              },
              "hash": {
                "not": true,
                "errorMessage": "如果没有 url，禁止定义 hash"
              }
            }
          }
        },
        {
          "$comment": "确保 architecture 和 autoupdate 中的属性相对应",
          "if": {
            "required": ["autoupdate"],
            "properties": {
              "autoupdate": {
                "required": ["architecture"]
              }
            }
          },
          "then": {
            "allOf": [
              {
                "if": {
                  "properties": {
                    "autoupdate": {
                      "properties": {
                        "architecture": {
                          "required": ["64bit"]
                        }
                      }
                    }
                  }
                },
                "then": {
                  "properties": {
                    "architecture": {
                      "required": ["64bit"]
                    }
                  }
                },
                "else": {
                  "properties": {
                    "architecture": {
                      "properties": {
                        "64bit": {
                          "not": true,
                          "errorMessage": "autoupdate 中的 architecture 没有定义 64bit"
                        }
                      }
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "autoupdate": {
                      "properties": {
                        "architecture": {
                          "required": ["32bit"]
                        }
                      }
                    }
                  }
                },
                "then": {
                  "properties": {
                    "architecture": {
                      "required": ["32bit"]
                    }
                  }
                },
                "else": {
                  "properties": {
                    "architecture": {
                      "properties": {
                        "32bit": {
                          "not": true,
                          "errorMessage": "autoupdate 中的 architecture 没有定义 32bit"
                        }
                      }
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "autoupdate": {
                      "properties": {
                        "architecture": {
                          "required": ["arm64"]
                        }
                      }
                    }
                  }
                },
                "then": {
                  "properties": {
                    "architecture": {
                      "required": ["arm64"]
                    }
                  }
                },
                "else": {
                  "properties": {
                    "architecture": {
                      "properties": {
                        "arm64": {
                          "not": true,
                          "errorMessage": "autoupdate 中的 architecture 没有定义 arm64"
                        }
                      }
                    }
                  }
                }
              },
              {
                "allOf": [
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "required": ["extract_dir"]
                        }
                      }
                    },
                    "then": {
                      "required": ["extract_dir"]
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "required": ["env_add_path"]
                        }
                      }
                    },
                    "then": {
                      "required": ["env_add_path"]
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "required": ["bin"]
                        }
                      }
                    },
                    "then": {
                      "required": ["bin"]
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "required": ["shortcuts"]
                        }
                      }
                    },
                    "then": {
                      "required": ["shortcuts"]
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "properties": {
                            "architecture": {
                              "patternProperties": {
                                "^(64bit|arm64|32bit)$": {
                                  "required": ["extract_dir"]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "architecture": {
                          "patternProperties": {
                            "^(64bit|arm64|32bit)$": {
                              "required": ["extract_dir"]
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "properties": {
                            "architecture": {
                              "patternProperties": {
                                "^(64bit|arm64|32bit)$": {
                                  "required": ["env_add_path"]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "architecture": {
                          "patternProperties": {
                            "^(64bit|arm64|32bit)$": {
                              "required": ["env_add_path"]
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "properties": {
                            "architecture": {
                              "patternProperties": {
                                "^(64bit|arm64|32bit)$": {
                                  "required": ["bin"]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "architecture": {
                          "patternProperties": {
                            "^(64bit|arm64|32bit)$": {
                              "required": ["bin"]
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "autoupdate": {
                          "properties": {
                            "architecture": {
                              "patternProperties": {
                                "^(64bit|arm64|32bit)$": {
                                  "required": ["shortcuts"]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "architecture": {
                          "patternProperties": {
                            "^(64bit|arm64|32bit)$": {
                              "required": ["shortcuts"]
                            }
                          }
                        }
                      }
                    }
                  }
                ]
              }
            ]
          }
        }
      ]
    }
  ]
}
